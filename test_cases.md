| Case ID | Failure Scenario                                        | Detection Method                            | Recovery Solution                                   | Notes/Best Practice                                |
| ------- | ------------------------------------------------------- | ------------------------------------------- | --------------------------------------------------- | -------------------------------------------------- |
| C1      | **Subscriber crash mid-transfer**                       | No ACK after timeout, missing chunks list   | Subscriber on restart sends `file/retry/<file_id>`  | Save partial chunks + chunk IDs on disk for resume |
| C2      | **Publisher crash mid-transfer**                        | Subscriber timeout, incomplete chunk set    | Publisher resumes or restarts file transfer         | Publisher checkpoints sent chunks before crash     |
| C3      | **Subscriber offline before transfer**                  | Broker detects no active subscriber         | Publisher retries until subscriber online           | Retained messages or last-will notifications       |
| C4      | **Publisher offline before transfer**                   | Subscriber idle waiting for metadata        | Subscriber sends periodic `file/status/<file_id>`   | Transfer starts once publisher comes back          |
| C5      | **Message lost in transit** (network)                   | Missing `chunk_id` at subscriber            | Retry request on `file/retry/<file_id>`             | QoS 1 retries automatically, duplicates possible   |
| C6      | **Out-of-order chunk arrival**                          | `chunk_id` mismatch during reassembly       | Buffer chunks until sequential order available      | Write sequentially only when next chunk present    |
| C7      | **Duplicate chunks** (QoS 1 resend)                     | Chunk ID already in received set            | Ignore duplicate chunks during write                | Idempotent write: safe to overwrite same chunk     |
| C8      | **Subscriber crash after full transfer but before ACK** | Publisher timeout waiting for `file/ack`    | Subscriber sends ACK on next startup if file intact | ACK must be persisted on subscriber side           |
| C9      | **Publisher crash after full transfer but before ACK**  | Subscriber idle waiting for retry/next file | Subscriber sends `file/status/<file_id>`            | ACK logic restarts after publisher recovers        |
| C10     | **Slow subscriber or burst overload**                   | Buffer growth exceeds limit                 | Use queue or backpressure, throttle publisher       | Burst smoothing or interval pacing on publisher    |
| C11     | **Subscriber never sends ACK** (logic bug)              | Publisher timeout after sending all chunks  | Retry limit, manual intervention if repeated fail   | Alert operator if persistent issue                 |
| C12     | **Network split** (broker unreachable)                  | Keepalive failure detection in MQTT         | Publisher buffers locally until broker reconnects   | MQTT handles reconnect, resend pending chunks      |
